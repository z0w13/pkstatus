import{Q as M}from"./QSkeleton-BGNcpZ0M.js";import{c as me,k as ve,g as pe,n as fe,d as _,h as L,e as A,R as ee,aq as te,aH as ge,r as p,t as ae,W as l,X as C,ah as se,T as he,S as ye,U as be,aI as j,w as we,aJ as _e,L as Se,ap as v,Z as a,Y as n,at as Q,aK as ke,v as xe,as as K,a5 as V,$ as y,aB as H,aD as G,a3 as m,a4 as Qe,a1 as U,a2 as Y,aL as Ce,aM as qe,a7 as Me}from"./index-B5cKJEsb.js";import{Q as F}from"./QSelect-D38puw0H.js";import{Q as J}from"./QPageSticky-C0FhqazD.js";import{Q as Ve,a as W,b as X}from"./QItem-DFQyp7xd.js";import{Q as Ie}from"./QList-CeI3M5mw.js";import{Q as Be}from"./QBtnDropdown-CQxCzmzF.js";import{Q as Le}from"./QPage-CQHXzn9r.js";import{Q as Ne}from"./QBtnGroup-BZaGG879.js";import{Q as $e}from"./QFooter-CKyJ_gWF.js";import{P as Pe}from"./PageTitle-DsxZJMWH.js";import{L as Ae}from"./LabeledTile-bczxvMPj.js";import{I as Z}from"./InitialFallbackAvatar-DdQhVARR.js";import"./QMenu-BD1NPTJN.js";import"./format-CPyQx2aO.js";import"./rtl-DFPa-2ov.js";import"./QResizeObserver-UMyGe1MO.js";import"./index-DhNyYKrN.js";const Ge=me({name:"QBanner",props:{...ve,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(S,{slots:u}){const{proxy:{$q:f}}=pe(),b=fe(S,f),g=_(()=>"q-banner row items-center"+(S.dense===!0?" q-banner--dense":"")+(b.value===!0?" q-banner--dark q-dark":"")+(S.rounded===!0?" rounded-borders":"")),k=_(()=>`q-banner__actions row items-center justify-end col-${S.inlineActions===!0?"auto":"all"}`);return()=>{const x=[L("div",{class:"q-banner__avatar col-auto row items-center self-start"},A(u.avatar)),L("div",{class:"q-banner__content col text-body2"},A(u.default))],r=A(u.action);return r!==void 0&&x.push(L("div",{class:k.value},r)),L("div",{class:g.value+(S.inlineActions===!1&&r!==void 0?" q-banner--top-padding":""),role:"alert"},x)}}}),Ue=ee({__name:"GroupSelect",props:{modelValue:{type:[String,Array]},modelModifiers:{}},emits:["update:modelValue"],setup(S){const{pluralKit:u}=te(),f=ge(S,"modelValue"),b=p(!0),g=p([]),k=p([]),x=_(()=>g.value.map(i=>({label:i.getName(),value:i.id})));function r(i,c){if(i===""){c(()=>{k.value=x.value});return}c(()=>{k.value=x.value.filter(({label:q,value:h})=>q.toLowerCase().includes(i.toLowerCase())||h.toLowerCase().includes(i.toLowerCase()))})}return ae(async()=>{g.value=await u.getOwnGroups(),k.value=x.value,f.value=Array.isArray(f.value)?[...f.value]:f.value,b.value=!1}),(i,c)=>(l(),C(F,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=q=>f.value=q),options:k.value,"map-options":"","use-input":"","emit-value":"",loading:b.value,readonly:b.value,onFilter:r},null,8,["modelValue","options","loading","readonly"]))}}),Fe=se(Ue,[["__file","/home/zowie/dev/pkstatus/src/components/GroupSelect.vue"]]),Oe={key:0,class:"row q-col-gutter-md"},Te={key:1,class:"row q-col-gutter-md q-mt-md"},ze={class:"col col-md-8"},Re={class:"row q-col-gutter-md q-mb-md",style:{"min-height":"64px"}},De={class:"col-auto self-center"},Ee={class:"col"},je=m("div",{class:"col-auto self-center"},"Selected Fronters:",-1),Ke={class:"col relative-position"},He={class:"row q-col-gutter-x-md q-col-gutter-y-none q-mb-md"},Ye={class:"col-sm-6 col-12"},Je={class:"col-sm-6 col-12"},We=m("div",{class:"col-sm-6 col-12"},null,-1),Xe=ee({__name:"SwitchPage",setup(S){const u=he(),f=ye(),{pluralKit:b,memberCache:g,groupCache:k,fronterCache:x}=te(),{detectPronouns:r,token:i,switcher:c}=be(f),q={"by-name":{value:"by-name",label:"Name",func:(e,s)=>ke(r.value)(e,s)},"by-last-message":{value:"by-last-message",label:"Last Message",func:(e,s)=>{var t,d;return(((t=s.lastMessageAt)==null?void 0:t.valueOf())||0)-(((d=e.lastMessageAt)==null?void 0:d.valueOf())||0)}}},h=p(!0),I=p(!1),B=p(""),w=p(""),o=p([]),O=p([]),N=p(),le=_(()=>q[c.value.lastSortMethod].func),$=_(()=>g.getCached(w.value)),T=_(()=>g.getMultiCached(o.value.toReversed())),oe=_(()=>g.getMultiCached(o.value).map(e=>({value:e.id,label:e.getName(r.value)}))),ne=_(()=>k.getMultiCached(c.value.excludeGroups).map(e=>e.members).flat()),re=_(()=>O.value.filter(e=>j(e.name,B.value)||j(e.displayName||"",B.value)).filter(e=>!ne.value.includes(e.id)).toSorted(le.value));function z(e){o.value.includes(e)?o.value.splice(o.value.indexOf(e),1):o.value.push(e),w.value==""&&(w.value=e),o.value.includes(w.value)||(w.value=o.value[0])}we(w,e=>{o.value[0]!=e&&(o.value.splice(o.value.indexOf(e),1),o.value.unshift(e))});async function ie(){await D()}async function ue(){if(I.value=!0,!!i.value){try{await b.createSwitch({members:o.value}),ce(o.value)}catch(e){if(!(e instanceof K))throw e;u.notify({type:"negative",message:`${e.status}: ${e.message} (${e.code})`})}I.value=!1}}function ce(e){var s,t;if(e.length==0)u.notify({type:"positive",message:"Switch-out registered."});else if(e.length==1){const d=(t=(s=g.getCached(e[0]))==null?void 0:s.getName(r.value))!=null?t:"Unknown";u.notify({type:"positive",message:`Switch registered. Current fronter is now ${d}.`})}else{const d=g.getMultiCached(e).map(E=>E.getName(r.value));u.notify({type:"positive",message:`Switch registered. Current fronters are now ${d.join(", ")}.`})}}async function de(){try{const e=await b.getOwnSystem();return e||u.notify({type:"negative",message:"Couldn't retrieve own system for some reason"}),e}catch(e){if(e instanceof K&&e.status=="401")return u.notify({type:"negative",message:"Invalid Token"}),null;throw e}}const R=p(216),P=_e(()=>{N.value&&(R.value=N.value.getBoundingClientRect().bottom-50)},100);async function D(){if(!i.value)return;h.value=!0;const e=await de();if(!e)return;O.value=await b.getOwnMembers();const s=await x.fetch(e.id,i.value);s.members.length>0&&(w.value=s.members[0].id,o.value=s.members.map(t=>t.id)),h.value=!1,xe(P)}return ae(async()=>{window.addEventListener("resize",P),await D()}),Se(()=>{window.removeEventListener("resize",P)}),(e,s)=>(l(),v(Q,null,[a(Le,{class:"row justify-evenly"},{default:n(()=>[V(" Member List "),y(i)?(l(),v("div",{key:0,class:"col col-md-8 bg-lighten q-px-lg q-pb-lg q-pt-sm",style:H(`margin-top: ${R.value}px`)},[h.value?(l(),v("div",Te,[(l(),v(Q,null,G(6,t=>m("div",{key:t,class:"col-xl-2 col-md-3 col-4"},[a(M,{type:"rect",style:{"aspect-ratio":"1/1"}})])),64))])):(l(),v("div",Oe,[(l(!0),v(Q,null,G(re.value,t=>(l(),v("div",{key:t.id,class:"col-xl-2 col-sm-3 col-4"},[a(Ae,{style:{"box-shadow":"0px 0px 3px 3px var(--q-primary)","user-select":"none"},img:t.avatarUrl,label:t.getName(y(r)),caption:t.getPronouns(y(r)),flat:!o.value.includes(t.id),size:"100%",onClick:d=>z(t.id)},null,8,["img","label","caption","flat","onClick"])]))),128))]))],4)):V("v-if",!0),a(J,{position:"top",offset:[0,0],expand:""},{default:n(()=>[m("div",ze,[V(" Title "),a(Pe,{icon:"swap_horiz",text:"Register Switch",class:"col-auto"}),y(i)?(l(),v(Q,{key:1},[V(" Header "),m("div",{ref_key:"searchForm",ref:N,class:"col-auto q-px-lg q-pt-md bg-lighten"},[m("div",Re,[h.value?(l(),v(Q,{key:0},[m("div",De,[a(M,{type:"rect",width:"121px",height:"21px"})]),m("div",Ee,[a(M,{type:"QAvatar"})])],64)):(l(),v(Q,{key:1},[je,m("div",Ke,[(l(!0),v(Q,null,G(T.value.entries(),([t,d])=>(l(),C(Z,{key:d.id,style:H(`left: ${(T.value.length-t-1)*25+5}px; position: absolute; box-shadow: 0 0 2px 2px black`),url:d.avatarUrl,name:d.getName(y(r)),onClick:E=>z(d.id)},null,8,["style","url","name","onClick"]))),128))])],64))]),m("div",He,[m("div",Ye,[h.value?(l(),C(M,{key:1,class:"QInput",height:"48px"})):(l(),C(F,{key:0,modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=t=>w.value=t),"bottom-slots":"","emit-value":"","map-options":"",options:oe.value,label:"Primary Fronter"},Ce({_:2},[$.value?{name:"append",fn:n(()=>[a(Z,{url:$.value.avatarUrl,name:$.value.getName(y(r))},null,8,["url","name"])]),key:"0"}:void 0]),1032,["modelValue","options"]))]),m("div",Je,[h.value?(l(),C(M,{key:1,class:"QInput",height:"48px"})):(l(),C(qe,{key:0,modelValue:B.value,"onUpdate:modelValue":s[1]||(s[1]=t=>B.value=t),"bottom-slots":"",label:"Search"},null,8,["modelValue"]))]),We])],512)],2112)):(l(),C(Ge,{key:0,class:"text-white bg-red col-auto"},{avatar:n(()=>[a(Qe,{name:"warning",color:"white"})]),action:n(()=>[a(U,{to:"/settings",flat:"",class:"bg-red text-white",label:"Go To Settings"})]),default:n(()=>[Y(" You need to set your PluralKit token to use this feature ")]),_:1}))])]),_:1}),V(" Filters "),a(J,{position:"bottom-right",offset:[18,18]},{default:n(()=>[a(Be,{fab:"",icon:"filter_alt",color:"primary","menu-offset":[0,18]},{default:n(()=>[a(Ie,{dense:"",bordered:"",separator:"",class:"rounded-borders"},{default:n(()=>[a(Ve,{header:""},{default:n(()=>[Y("Filters")]),_:1}),a(Me),a(W,null,{default:n(()=>[a(X,null,{default:n(()=>[a(F,{modelValue:y(c).lastSortMethod,"onUpdate:modelValue":s[2]||(s[2]=t=>y(c).lastSortMethod=t),borderless:"",label:"Sort By","map-options":"","emit-value":"",options:Object.values(q)},null,8,["modelValue","options"])]),_:1})]),_:1}),a(W,null,{default:n(()=>[a(X,null,{default:n(()=>[a(Fe,{modelValue:y(c).excludeGroups,"onUpdate:modelValue":s[3]||(s[3]=t=>y(c).excludeGroups=t),borderless:"",label:"Exclude Groups",multiple:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a($e,null,{default:n(()=>[a(Ne,{spread:"",style:{height:"50px"}},{default:n(()=>[a(U,{color:"negative",icon:"restart_alt",label:"Reset",onClick:ie}),a(U,{color:"positive",icon:"swap_horiz",label:"Switch",disabled:h.value||I.value,loading:h.value||I.value,onClick:ue},null,8,["disabled","loading"])]),_:1})]),_:1})],64))}}),ht=se(Xe,[["__file","/home/zowie/dev/pkstatus/src/pages/SwitchPage.vue"]]);export{ht as default};
