import{Q as x,a as p}from"./QTabs-CVdLadnF.js";import{Q as q}from"./QToolbar-DFKVFXad.js";import{Q as N}from"./QFooter-CKyJ_gWF.js";import{R as P,aS as T,S as C,aq as F,U as V,r as l,w as A,V as R,W as u,ap as c,at as w,Z as a,Y as f,X as B,a4 as b,a2 as h,a5 as D,as as g,aK as k,$ as v,aU as E,ah as G}from"./index-B5cKJEsb.js";import{S as K,D as L}from"./DescriptionDialog-ClBvxs1u.js";import"./QResizeObserver-UMyGe1MO.js";import"./rtl-DFPa-2ov.js";import"./QMarkupTable-BdHJVmiq.js";import"./MemberCard-D-huDLNl.js";import"./InitialFallbackAvatar-DdQhVARR.js";import"./index-DhNyYKrN.js";import"./RelativeTimeDisplay-CTCOZZ8Y.js";const M={key:2,class:"row q-mt-lg q-pa-md bg-lighten q-pa-md"},U={key:3,class:"row q-mt-lg q-pa-md bg-lighten"},z=P({__name:"IndexPage",setup(W){const i=T(),S=C(),{pluralKit:m}=F(),{detectPronouns:y}=V(S),r=l("loading"),n=l(null),d=l(null),t=l({loading:!0,allowed:!0,list:[]}),s=l({loading:!0,allowed:!0,list:[]}),_=l();return A(()=>i.params.id,async o=>{if(!(!o||Array.isArray(o))){n.value=null,d.value=null,t.value.loading=!0,t.value.list=[],s.value.loading=!0,s.value.list=[];try{n.value=await m.getSystem(o)}catch(e){e instanceof g&&(e.status=="404"?r.value="notfound":e.status=="403"&&(r.value="forbidden"));return}d.value=await m.getFronters(o);try{t.value.list=(await m.getMembers(o)).sort(k(y.value)),t.value.loading=!1,t.value.allowed=!0}catch(e){if(e instanceof g&&e.status=="403")t.value={loading:!1,allowed:!1,list:[]};else throw e}try{s.value.list=(await m.getGroups(o)).sort(k(y.value)),s.value.loading=!1,s.value.allowed=!0}catch(e){if(e instanceof g&&e.status=="403")s.value={loading:!1,allowed:!1,list:[]};else throw e}}},{immediate:!0}),(o,e)=>{const Q=R("router-view");return u(),c(w,null,[n.value?(u(),c(w,{key:0},[a(K,{system:n.value,flat:""},null,8,["system"]),a(Q,{dialog:_.value,system:n.value,fronters:d.value,members:t.value,groups:s.value},null,8,["dialog","system","fronters","members","groups"]),a(N,null,{default:f(()=>[a(q,null,{default:f(()=>[a(x,{align:"center",class:"bg-primary full-width"},{default:f(()=>[a(p,{to:{name:"lookup-system-fronters",params:{id:v(i).params.id}},color:"primary",icon:"person_search",label:"Fronters"},null,8,["to"]),a(p,{to:{name:"lookup-system-members",params:{id:v(i).params.id}},color:"primary",icon:"people",label:"Members"},null,8,["to"]),a(p,{to:{name:"lookup-system-groups",params:{id:v(i).params.id}},color:"primary",icon:"group",label:"Groups"},null,8,["to"])]),_:1})]),_:1})]),_:1})],64)):r.value=="loading"?(u(),B(E,{key:1,indeterminate:""})):r.value=="forbidden"?(u(),c("div",M,[a(b,{name:"cross"}),h(" Not Allowed To View System ")])):r.value=="notfound"?(u(),c("div",U,[a(b,{name:"error"}),h(" System Not Found ")])):D("v-if",!0),a(L,{ref_key:"dialog",ref:_},null,512)],64)}}}),se=G(z,[["__file","/home/zowie/dev/pkstatus/src/pages/Lookup/System/IndexPage.vue"]]);export{se as default};
